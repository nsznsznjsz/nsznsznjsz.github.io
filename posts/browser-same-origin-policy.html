<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <link rel="icon" href="/logo.png"><title>浏览器同源政策 | Celeste's blog</title><meta name="description" content="Technique && Life"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.21">
    <link rel="modulepreload" href="/assets/app.cad05c30.js"><link rel="modulepreload" href="/assets/browser-same-origin-policy.html.eb896691.js"><link rel="modulepreload" href="/assets/browser-same-origin-policy.html.41dc5a28.js">
    <link rel="stylesheet" href="/assets/style.b2f4734d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="layout"><main class="layout__main"><!--[--><article class="page prose max-w-none"><!--[--><h1 id="浏览器同源政策" tabindex="-1"><a class="header-anchor" href="#浏览器同源政策" aria-hidden="true">#</a> 浏览器同源政策</h1><h2 id="判断方式" tabindex="-1"><a class="header-anchor" href="#判断方式" aria-hidden="true">#</a> 判断方式</h2><ol><li>协议相同</li><li>域名相同</li><li>端口相同</li></ol><h3 id="cookie、localstorage-和-indexdb-无法读取" tabindex="-1"><a class="header-anchor" href="#cookie、localstorage-和-indexdb-无法读取" aria-hidden="true">#</a> Cookie、LocalStorage 和 IndexDB 无法读取</h3><p>Cookie 只有同源的网页才能共享</p><ul><li>如果一级域名相同, 可以将两个页面设置相同的 domain 共享 Cookie</li></ul><div class="language-JS ext-JS line-numbers-mode"><pre class="language-JS"><code>document.domain = &#39;example.com&#39;; // 指定Cookie的所属域名为一级域名
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="dom-无法获得" tabindex="-1"><a class="header-anchor" href="#dom-无法获得" aria-hidden="true">#</a> DOM 无法获得</h3><p>以下代码受到限制</p><div class="language-JS ext-JS line-numbers-mode"><pre class="language-JS"><code>document.getElementById(&quot;myIFrame&quot;).contentWindow.document
window.parent.document.body
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="解决方法" tabindex="-1"><a class="header-anchor" href="#解决方法" aria-hidden="true">#</a> 解决方法</h3><h4 id="一级域名相同" tabindex="-1"><a class="header-anchor" href="#一级域名相同" aria-hidden="true">#</a> 一级域名相同</h4><div class="language-JS ext-JS line-numbers-mode"><pre class="language-JS"><code>document.domain = &#39;example.com&#39;; // 两个网站都需要设置, 且完全相等
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="一级域名不相同" tabindex="-1"><a class="header-anchor" href="#一级域名不相同" aria-hidden="true">#</a> 一级域名不相同</h4><h5 id="片段识别符" tabindex="-1"><a class="header-anchor" href="#片段识别符" aria-hidden="true">#</a> 片段识别符</h5><p><strong>原理</strong>: 只改变片段标识符，不会引起页面刷新</p><ol><li>父窗口写 <code>URL#hash</code></li><li>子窗口监听 hashchange</li></ol><h5 id="window-name" tabindex="-1"><a class="header-anchor" href="#window-name" aria-hidden="true">#</a> window.name</h5><p><strong>原理</strong>: window.name容量很大，可以放置非常长的字符串</p><p><strong>缺点</strong>: 必须监听子窗口window.name属性的变化，影响网页性能</p><ol><li>父窗口打开子窗口，写入 name</li><li>子窗口写入name，跳转至父窗口同域名网页</li></ol><h5 id="cross-document-messaging" tabindex="-1"><a class="header-anchor" href="#cross-document-messaging" aria-hidden="true">#</a> cross-document messaging</h5><div class="language-JS ext-JS line-numbers-mode"><pre class="language-JS"><code>postMessage(&#39;Hello World!&#39;, &#39;http://bbb.com&#39;)

window.addEventListener(&#39;message&#39;, handleMessage)

event = {
  source, // 发送消息的窗口
  origin, // 消息发向的网址
  data // 消息内容
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="ajax-请求不能发送" tabindex="-1"><a class="header-anchor" href="#ajax-请求不能发送" aria-hidden="true">#</a> AJAX 请求不能发送</h2><h3 id="jsonp" tabindex="-1"><a class="header-anchor" href="#jsonp" aria-hidden="true">#</a> JSONP</h3><p>添加一个&lt;script&gt;元素，向服务器请求JSON数据</p><p>缺点: 只能发送 GET 请求</p><h3 id="websocket" tabindex="-1"><a class="header-anchor" href="#websocket" aria-hidden="true">#</a> WebSocket</h3><p>设置 origin</p><h3 id="cors" tabindex="-1"><a class="header-anchor" href="#cors" aria-hidden="true">#</a> CORS</h3><h4 id="简单请求" tabindex="-1"><a class="header-anchor" href="#简单请求" aria-hidden="true">#</a> 简单请求</h4><p><strong>条件</strong></p><ol><li>三种类型之一: HEAD, GET, POST</li><li>只允许以下头信息: Accept, Accept-Language, Content-Language, Last-Event-ID</li><li>Content-Type: 限于三个值 <ul><li>application/x-www-form-urlencoded</li><li>multipart/form-data</li><li>text/plain</li></ul></li></ol><h4 id="非简单请求" tabindex="-1"><a class="header-anchor" href="#非简单请求" aria-hidden="true">#</a> 非简单请求</h4><!--]--></article><!--]--></main><aside class="layout__sub"><!--[--><div>Sidebar</div><!--]--></aside><aside class="layout__extra"><!--[--><div class="sticky top-12 p-4 mr-8"><h3 class="pb-1 text-lg font-bold select-none">CATALOG</h3><ul><!--[--><li class="catalog__item"><a aria-current="page" href="/posts/browser-same-origin-policy.html#%E5%88%A4%E6%96%AD%E6%96%B9%E5%BC%8F" class="router-link-active router-link-exact-active catalog__link">判断方式</a><!----></li><li class="catalog__item"><a aria-current="page" href="/posts/browser-same-origin-policy.html#ajax-%E8%AF%B7%E6%B1%82%E4%B8%8D%E8%83%BD%E5%8F%91%E9%80%81" class="router-link-active router-link-exact-active catalog__link">AJAX 请求不能发送</a><!----></li><!--]--></ul></div><!--]--></aside><header class="layout__header"><!--[--><div class="header h-full flex flex-col justify-center items-center relative overflow-hidden"><div class="flex flex-col items-start"><div class="z-30 min-w-max"><!--[--><a href="/tags/browser.html" class="header__pill-link" style="--pill-color:#00bcd4;">浏览器</a><!--]--><a class="header__pill-link" href="https://github.com/nsznsznjsz/blog/edit/main/2019/10/28/browser-same-origin-policy.md" target="_blank">编辑此页</a></div><h1 class="my-6 z-30 text-white text-8xl font-medium">浏览器同源政策</h1></div><div class="flex z-30"><div class="header__meta-item">发表于 2019-10-28</div><div class="header__meta-item">更新于 2021-3-20</div></div><div class="flex z-30"><div class="header__meta-item"> 分类于 <!--[--><span class="header__categories"><!--[--><a href="/categories/computer-science.html" class="header__category">计科</a><a href="/categories/computer-science/front-end.html" class="header__category">前端</a><!--]--></span><!--]--></div></div></div><!--]--></header><footer class="layout__footer"><!--[--><div class="flex flex-col items-center m-4 py-4 text-gray-400 text-sm select-none"><span>Copyright © 2021 – 2021 Celeste</span><span>Powered by <a href="https://vuepress.vuejs.org/" target="_blank" class="underline">Vuepress</a></span></div><!--]--></footer><nav class="layout__nav overflow-hidden z-50"><!--[--><div class="navbar navbar_transparent" style=""><ul class="flex"><li class="navbar__link"><a href="/" class="font-bold">CELESTE&#39;S BLOG</a></li></ul><ul class="flex"><!--[--><li class="navbar__link"><a href="/archives.html" class="">ARCHIVES</a></li><li class="navbar__link"><a href="/categories.html" class="">CATEGORIES</a></li><li class="navbar__link"><a href="/tags.html" class="">TAGS</a></li><li class="navbar__link"><a href="/about.html" class="">ABOUT</a></li><!--]--></ul></div><!--]--></nav><!----></div><!--]--></div>
    <script type="module" src="/assets/app.cad05c30.js" defer></script>
  </body>
</html>
