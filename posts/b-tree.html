<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <link rel="icon" href="/logo.png"><title>B树的插入与删除 | Celeste's blog</title><meta name="description" content="Technique && Life"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.21">
    <link rel="modulepreload" href="/assets/app.cad05c30.js"><link rel="modulepreload" href="/assets/b-tree.html.f52ad21a.js"><link rel="modulepreload" href="/assets/b-tree.html.edb653c3.js">
    <link rel="stylesheet" href="/assets/style.b2f4734d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="layout"><main class="layout__main"><!--[--><article class="page prose max-w-none"><!--[--><p>B 树是一种自平衡树，能够保持数据的有序，且拥有良好的查找性能和更少的读盘次数，常用于文件系统和数据库的设计实现中。B 树由二叉树发展而来，平衡二叉树在查找性能达到了对数时间 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi></mrow><annotation encoding="application/x-tex">log_{2}n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">n</span></span></span></span></span>，在内部查找时十分高效，但是在外部查找中由于 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mrow><mi>I</mi><mi>O</mi></mrow></msub><mo>&gt;</mo><mo>&gt;</mo><msub><mi>t</mi><mrow><mi>s</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>c</mi><mi>h</mi></mrow></msub></mrow><annotation encoding="application/x-tex">t_{IO}&gt;&gt;t_{search}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">se</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">rc</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>，人们希望设计一种能够尽可能减少读盘次数的数据结构。顺着二叉树的思路，人们在二叉树的基础上该进得到了 B 树（m 叉查找树），将树高降到了 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mi>m</mi></msub><mi>n</mi></mrow><annotation encoding="application/x-tex">log_{m}n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">n</span></span></span></span></span>。</p><h2 id="定义" tabindex="-1"><a class="header-anchor" href="#定义" aria-hidden="true">#</a> 定义</h2><p>一个 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span></span> 阶的 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span> 树是有以下属性的树：</p><ol><li>每一个节点最多有 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span></span> 个子节点；</li><li>每一个节点（除根节点）最少有 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⌊</mo><mi>m</mi><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">\lfloor m/2 \rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">⌊</span><span class="mord mathnormal">m</span><span class="mord">/2</span><span class="mclose">⌋</span></span></span></span></span> 个子节点；</li><li>如果根节点不是叶子节点，那么它至少有两个子节点</li><li>有 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></span> 个子节点的非叶子节点拥有 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span> 个键</li><li>所有的叶子节点都在同一层</li></ol><p>其中性质 2 和性质 4 的约束使 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span> 树至少为一颗半满的树来保证存储密度；<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span> 树的叶子节点通常指的是额外填充的空节点，当查找操作到达空节点时，即代表查找失败，这一层叶节点可以计入 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span> 树的高度，也可以不计入。</p><h2 id="查找" tabindex="-1"><a class="header-anchor" href="#查找" aria-hidden="true">#</a> 查找</h2><p><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span> 树的查找过程与二叉树查找过程十分相似，只是划分区域略有差别，如下图（以 3 阶 B 树为例）：</p><p><img src="/assets/b-tree-search.c72ad6c2.png" alt="B树查找过程"></p><p>通过递归的查找遍历每一层的 B 树，必定处于下列三种情况之一：</p><ol><li>位于当前节点的数据中，查找成功；</li><li>位于当前节点的子节点区间中，向下递归；</li><li>当前节点为叶子节点（空节点），查找失败。</li></ol><h2 id="插入" tabindex="-1"><a class="header-anchor" href="#插入" aria-hidden="true">#</a> 插入</h2><p>B 树的插入过程与平衡二叉树十分相似，同样分为查找和调整两步。查找过程如上述，找到非叶子的最底层节点将其插入，以下列三阶 B 树为例（叶子节点省略）：</p><p><img src="/assets/b-tree-insert-1.30372f22.png" alt="示例三阶B树"></p><blockquote><p>三阶 B 树指的是子节点数量最多为 3，键值数量最多为 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>−</mo><mn>2</mn><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">3-2=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span></span>，因此键值数量最少为 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⌊</mo><mn>3</mn><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">⌋</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\lfloor 3/2 \rfloor =1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">⌊</span><span class="mord">3/2</span><span class="mclose">⌋</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span>，子节点数量最少为 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mn>1</mn><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">1+1=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span></span></p></blockquote><p>插入 90，先查找插入位置，直到找到最底层节点 70（非叶子节点），将 90 插入到 70 右侧，当前节点可以容纳该数据，无需调整：</p><p><img src="/assets/b-tree-insert-2.62de3b09.png" alt="插入90过程"></p><p>插入 80，过程如下：</p><ol><li>查找插入位置为 70 与 90 之间，将其插入，此时该节点子节点数量为 4，需要调整；</li><li>将当前节点以 80 为枢轴分裂为三部分：80 左侧（只有 70）、80、80 右侧（只有 90）。将 9-提入根节点，70 和 90 分别为其两个子节点，将当前节点设为其父节点，此时满足 3 阶 B 树定义，调整结束。</li></ol><p><img src="/assets/b-tree-insert-3.1829f35b.png" alt="插入"></p><p>插入 100，查找后直接插入，无需调整，得到：</p><p><img src="/assets/b-tree-insert-4.2a88d0bf.png" alt="插入100过程"></p><p>插入 85，过程如下：</p><ol><li>应插入 90 所在节点左侧，但是该节点满，需要调整；</li><li>将当前节点分裂为三部分，90 提到其父节点（根节点），85 和 100 分别为其子节点，当前节点移动到其父节点（根节点），当前节点满，需要调整；</li><li>将 80 提出，成为新的根节点，50 和 90 成为其子节点，树高加一。当前节点移动到其父节点（新根节点 80），此时满足三阶 B 树定义，调整结束。</li></ol><p><img src="/assets/b-tree-insert-5.9b7e1688.png" alt="插入85过程"></p><h2 id="删除" tabindex="-1"><a class="header-anchor" href="#删除" aria-hidden="true">#</a> 删除</h2><p>B 树的删除同样分为查找和调整两个步骤，查找过程如上述，找到当前节点并删除键值后，可能会违背定义 2 的限制，此时需要向兄弟节点（一定存在）借键值，此时会出现四种情况：</p><ol><li>删去该键值后成为空树；</li><li>删去该键值后依然满足定义；</li><li>删去该键值后不再满足定义，兄弟节点可以借；</li><li>删去该键值后不再满足定义且兄弟节点不够借。</li></ol><p>前两种情况时，直接删去即可；</p><p>第三种情况时，需要向兄弟节点借一个键值，即可满足定义；</p><blockquote><p>说是向兄弟节点借，但实际上是轮转，即父节点键值到当前节点，兄弟节点键值到父节点，详见示例</p></blockquote><p>第四种情况时，需要合并兄弟节点，当前节点移动至父节点，父节点少一个节点，可视为删除父节点一个键值，递归直到成为前三种情况。</p><h3 id="删除-向兄弟节点借入" tabindex="-1"><a class="header-anchor" href="#删除-向兄弟节点借入" aria-hidden="true">#</a> 删除：向兄弟节点借入</h3><p>删除键值 230（五阶 B 树）：</p><p><img src="/assets/b-tree-delete-1.d0a4cf3f.png" alt="删除示例一"></p><h3 id="删除-兄弟节点不够借" tabindex="-1"><a class="header-anchor" href="#删除-兄弟节点不够借" aria-hidden="true">#</a> 删除：兄弟节点不够借</h3><p><img src="/assets/b-tree-delete-2.a15d5fbb.png" alt="B树删除示例二"></p><!--]--></article><!--]--></main><aside class="layout__sub"><!--[--><div>Sidebar</div><!--]--></aside><aside class="layout__extra"><!--[--><div class="sticky top-12 p-4 mr-8"><h3 class="pb-1 text-lg font-bold select-none">CATALOG</h3><ul><!--[--><li class="catalog__item"><a aria-current="page" href="/posts/b-tree.html#%E5%AE%9A%E4%B9%89" class="router-link-active router-link-exact-active catalog__link">定义</a><!----></li><li class="catalog__item"><a aria-current="page" href="/posts/b-tree.html#%E6%9F%A5%E6%89%BE" class="router-link-active router-link-exact-active catalog__link">查找</a><!----></li><li class="catalog__item"><a aria-current="page" href="/posts/b-tree.html#%E6%8F%92%E5%85%A5" class="router-link-active router-link-exact-active catalog__link">插入</a><!----></li><li class="catalog__item"><a aria-current="page" href="/posts/b-tree.html#%E5%88%A0%E9%99%A4" class="router-link-active router-link-exact-active catalog__link">删除</a><!----></li><!--]--></ul></div><!--]--></aside><header class="layout__header"><!--[--><div class="header h-full flex flex-col justify-center items-center relative overflow-hidden"><div class="flex flex-col items-start"><div class="z-30 min-w-max"><!--[--><a href="/tags/data-structure.html" class="header__pill-link" style="--pill-color:#9c27b0;">数据结构</a><a href="/tags/tree.html" class="header__pill-link" style="--pill-color:#00bcd4;">树</a><!--]--><a class="header__pill-link" href="https://github.com/nsznsznjsz/blog/edit/main/2021/02/14/b-tree.md" target="_blank">编辑此页</a></div><h1 class="my-6 z-30 text-white text-8xl font-medium">B树的插入与删除</h1></div><div class="flex z-30"><div class="header__meta-item">发表于 2021-02-14</div><div class="header__meta-item">更新于 2021-3-5</div></div><div class="flex z-30"><div class="header__meta-item"> 分类于 <!--[--><span class="header__categories"><!--[--><a href="/categories/computer-science.html" class="header__category">计科</a><a href="/categories/computer-science/data-structure.html" class="header__category">数据结构</a><a href="/categories/computer-science/data-structure/tree.html" class="header__category">树</a><!--]--></span><!--]--></div></div></div><!--]--></header><footer class="layout__footer"><!--[--><div class="flex flex-col items-center m-4 py-4 text-gray-400 text-sm select-none"><span>Copyright © 2021 – 2021 Celeste</span><span>Powered by <a href="https://vuepress.vuejs.org/" target="_blank" class="underline">Vuepress</a></span></div><!--]--></footer><nav class="layout__nav overflow-hidden z-50"><!--[--><div class="navbar navbar_transparent" style=""><ul class="flex"><li class="navbar__link"><a href="/" class="font-bold">CELESTE&#39;S BLOG</a></li></ul><ul class="flex"><!--[--><li class="navbar__link"><a href="/archives.html" class="">ARCHIVES</a></li><li class="navbar__link"><a href="/categories.html" class="">CATEGORIES</a></li><li class="navbar__link"><a href="/tags.html" class="">TAGS</a></li><li class="navbar__link"><a href="/about.html" class="">ABOUT</a></li><!--]--></ul></div><!--]--></nav><!----></div><!--]--></div>
    <script type="module" src="/assets/app.cad05c30.js" defer></script>
  </body>
</html>
